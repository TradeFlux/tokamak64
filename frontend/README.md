# TOKAMAK64 Flutter Client

Flutter frontend for TOKAMAK64, featuring FFI bindings to the Rust backend via `flutter_rust_bridge`.

## Setup

### Prerequisites

- Flutter 3.10.4+
- Rust 1.91.1+ (for building native libraries)
- Platform-specific build tools:
  - **macOS**: Xcode Command Line Tools
  - **Linux**: gcc, libstdc++
  - **Windows**: MSVC or MinGW

### Install Dependencies

```bash
flutter pub get
```

### Generate Rust FFI Bindings

The `flutter_rust_bridge` code generator creates Dart bindings from the Rust FFI crate.

```bash
flutter pub run flutter_rust_bridge_codegen
```

This generates bindings in `lib/generated/` from the Rust crate at `../backend/ffi`.

### Build Native Library

Build the FFI dylib/so for your platform:

```bash
# macOS (arm64)
cargo build -p tokamak-ffi --release

# Linux (x86_64)
cargo build -p tokamak-ffi --release --target x86_64-unknown-linux-gnu

# Windows (x86_64)
cargo build -p tokamak-ffi --release --target x86_64-pc-windows-msvc
```

Output goes to `../backend/target/release/`.

## Running

### macOS/Linux/Windows Desktop

```bash
flutter run
```

The app expects the FFI dylib in the system library path. For development, ensure it's available via `LD_LIBRARY_PATH` (Linux) or by building within Xcode's derived data.

### Mobile (Future)

iOS and Android support is scaffolded in `flutter_rust_bridge.yaml` but not yet enabled. To add mobile support:

1. Enable iOS/Android in the YAML
2. Configure cross-compilation in `../backend/ffi/Cargo.toml`
3. Set up platform-specific dylib linking in Xcode/Android build configs

## Project Structure

```
lib/
├── main.dart              # Entry point, theme, home screen
├── ffi/
│   └── ffi_binding.dart   # FFI initialization and dylib loading
└── generated/             # Auto-generated by flutter_rust_bridge
    └── tokamak_ffi_bindings.dart
```

## Architecture Notes

- **lib/main.dart**: Skeleton UI; replace with actual game board/UI
- **lib/ffi/ffi_binding.dart**: Loads the native library and exports generated bindings
- **Generated bindings** provide type-safe Dart wrappers for all Rust FFI types and functions

Use the exported types from `lib/ffi/ffi_binding.dart` to interact with the Rust backend:

```dart
import 'lib/ffi/ffi_binding.dart';

// Example: interact with types from tokamak-ffi
// final board = Board(...);
```
